<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <title>Charts</title>
  <link rel="stylesheet" href="style.css">
  <!-- <script src="papaparse.min.js"></script> -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
</head>

<body>
  <h1>Covid-19 Daily Tracking</h1>

  <h4 id="n"></h4>








  <canvas id="chart" width="200" height="70"></canvas>
  <script>


    chartIt();

    //let name = document.getElementById("n1").value;

    let _colorIndex = 0;
    function getNextColor() {
      let colors = [
        "red", "green", "blue", "purple",
      ];
      return colors[_colorIndex++ % colors.length];
    }
    let labelIndex = 0;
    function getNextLabel() {
      var usstate = document.getElementById("n1").value;

      let l = [
        "FL", "NC", usstate,
      ];

      return l[labelIndex++ % l.length];
    }

    async function chartIt() {
      //  var usstate = document.getElementById("n1");
      //   console.log(usstate);
      //   document.getElementById("n").innerHTML = usstate;

      const data = await getData();
      const ctx = document.getElementById("chart").getContext("2d");

      const myChart = new Chart(ctx, {
        type: "line",
        data: {
          labels: data.xs,
          datasets: data.datasets.map(dataset => {
            let t = getNextLabel();
            let color = getNextColor();

            return {

              label: t,
              data: dataset,
              backgroundColor: color,
              borderColor: color,
              borderWidth: 1,
              fill: false,
            };
          }),
        },
        options: {
          scales: {
            xAxes: [{
              display: true,
            }],
            yAxes: [{
              display: true,
              beginAtZero: true
              //type: 'logarithmic',
            }]
          },
        },
      });
    }

    function getProp(obj, name, defaultValue) {
      if (obj && obj[name] !== undefined) {
        return obj[name];
      } else {
        return defaultValue;
      }
    }

    async function getData(stateNames) {
      var usState = document.getElementById("n1").value;
      console.log(usState);
      const xs = [];
      const flData = [];
      const ncData = [];
      const usStateData = [];


      let rawData = await fetch(
        "https://covidtracking.com/api/v1/states/daily.json"
      ).then(res => res.json());

      let data = rawData.reduce((res, row) => {
        if (res[row.date] === undefined) {
          res[row.date] = [];
        }

        res[row.date].push(row);

        return res;
      }, {});


      for (let [date, rows] of Object.entries(data)) {
        xs.push(date);
        var dd = document.getElementById("n2").value;
        document.getElementById("n").innerHTML = dd;

    flData.push(getProp(rows.find(row => row.state === 'FL'), dd, 0));
        ncData.push(getProp(rows.find(row => row.state === 'NC'), dd, 0));
        usStateData.push(getProp(rows.find(row => row.state === usState), dd, 0));
      }

      return { xs, datasets: [flData, ncData, usStateData] };
    }

  </script>

  <p>State Abbreviation: <input id="n1" placeholder="state"></p>
  <p><a href="https://www.50states.com/abbreviations.htm" target="_blank">I don't know my states...</a></p>
    <label for="cars">Data Type:</label>
    <select id="n2" name="dataType">
      <option value="positiveIncrease">positiveIncrease</option>
      <option value="negativeIncrease">negativeIncrease</option>
      <option value="totalTestResults">totalTestResults</option>
      <option value="positive">positive</option>
      <option value="negative">negative</option>
      <option value="death">death</option>
    </select>
   <button onclick="getData();chartIt();" id="btn1">Submit</button></p>

</body>
</html>
